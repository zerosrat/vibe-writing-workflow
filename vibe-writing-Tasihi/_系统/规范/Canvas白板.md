# Canvas白板规范

Canvas结构编辑的核心规则。

---

## 🎯 核心规则

### 路径格式（最重要）
- **file路径必须从工作目录名开始**（通过pwd自动获取）
- **AI执行步骤**：
  1. 执行 `pwd` → 获取完整路径（如 `/Users/.../vibe-writing-Tasihi`）
  2. 提取最后一级目录名 → `vibe-writing-Tasihi`（存为{WORK_DIR}）
  3. 用Glob读取实际路径，确保中文标点正确（`，`、`？`、`！`）
  4. 构建Canvas路径：`{WORK_DIR}/项目/...`
- ✅ 正确：`vibe-writing-Tasihi/项目/AI为什么能秒懂/输出卡片/...`
- ❌ 错误：`项目/...`（缺少工作目录前缀）或使用英文标点

### 文本内容
- 禁止中文双引号`""`（会导致Canvas打开失败）
- 改用：`「」`

### 节点高度
根据文件行数设置：20-30行→600px, 40-50行→900px, 50+行→1100px

---

## 🔗 连接线设计

**原则**：
- 用问题形式（不是陈述句）
- 问题要完整、有上下文（让读者看懂在问什么）
- 不重复节点内容（节点已经说了，连接线别再说）

**示例**：
- ❌ "为什么要计算两次？"（缺少上下文）
- ✅ "预训练和推理都计算关系，为什么要计算两次？"（有上下文，问题清晰）

---

## 🎨 纵向布局

**布局原则**：所有卡片纵向排列（x=100固定，y递增）

**坐标规则**：
- 第1张：x=100, y=100
- 第2张：x=100, y=900（间隔800）
- 第3张：x=100, y=1700
- width: 800, height: 根据文件行数计算

**连接关系**：
- 已连接卡片：fromSide:"bottom", toSide:"top", label用`「」`
- 独立卡片：暂无连接线

---

## 🔄 操作流程

### 阶段1：迭代完成后自动添加

**触发**：写作Agent完成迭代

**执行**：
1. 检查Canvas是否存在（不存在→创建，存在→Read）
2. 用Glob读取当前卡片实际路径（确保标点正确）
3. 计算坐标：x=100, y=100+(现有卡片数×800)
4. 创建file节点（type:"file", color:"2"）
5. Write保存

### 阶段2：用户主动组织白板

**触发**：用户说"组织白板"、"建立连接"

**执行**：
1. Read Canvas → 识别已连接/独立卡片
2. 分析逻辑关系 → 提供2-3种组织方案
3. 用户确认后：
   - 纵向排列（x=100，y递增）
   - 创建连接线（label用`「」`，问题完整）
   - 对比项目信息.md，保留用户手动修改
4. 更新项目信息.md的"白板组织记录"
5. Write保存

---

## 🧩 节点组织原则

**内容逻辑 > 文件拆分**

如果多个md文件讲同一完整过程 → 先在文件系统中合并md文件 → 再创建Canvas节点

理由：Canvas file节点 = md文件本身（双向同步）
