# 核心规范

所有Agent必须遵守的核心规则。

---

## 📊 项目信息.md更新规范

### 字段结构（7大字段）

#### A. 基础信息（初始化后不变）
```markdown
# 项目信息
**项目名称**：[项目名]
**创建时间**：[YYYY-MM-DD]
```
- 初始化：学习Agent（项目启动时）
- 更新者：无

#### B. 学习状态（学习Agent专属）
```markdown
## 📚 学习状态（v0.1）
**当前轮次**：第X轮
**距上次生成**：Y轮
**已生成知识卡片**：Z张
```
- 更新者：学习Agent
- 更新时机：每次回答后 + 生成卡片后

#### C. 输出状态（写作Agent专属）
```markdown
## ✨ 输出状态（v0.2+）
**当前正在优化**：[路径] ← [[知识卡片]]（阶段说明） 或 无
```
- 更新者：写作Agent
- 更新时机：开始优化时设置，完成后清空为"无"

#### D. 知识卡片列表（学习Agent维护）
```markdown
## 📝 已生成的知识卡片

### 第X-Y轮生成
1. [[知识卡片/[标题]|[标题]]]
```
- 更新者：学习Agent
- 更新时机：生成卡片后

#### E. 输出卡片列表（写作Agent维护）
```markdown
## ✨ 输出卡片（优化后）
1. [[输出卡片/主题/01-节点.md|主题]] ← [[知识卡片/[标题]|[标题]]]
```
- 更新者：写作Agent
- 更新时机：生成输出卡片后

#### F. 待转化列表（写作Agent维护）
```markdown
## 📋 待转化知识卡片
- [[知识卡片/[标题]|[标题]]]

**说明**：已转化的卡片会自动从此列表移除。如不想转化某张卡片，可手动删除。
```
- 初始化：写作Agent（第一次输出时，自动检测为空则生成）
- 更新者：写作Agent
- 更新时机：转化完成后移除

#### G. 结构分析记录（结构Agent记录）
```markdown
## 📊 文章结构分析
**最近分析**（[日期]）：
- 已完成：[[输出卡片/主题/...|主题]]
- 选择方案：接下来写[X]，理由是[...]
```
- 更新者：结构Agent
- 更新时机：每次"分析下一步写什么"后

### 更新职责解耦

| 字段 | 学习Agent | 结构Agent | 写作Agent |
|------|-----------|-----------|-----------|
| 基础信息 | ✅ 初始化 | - | - |
| 学习状态 | ✅ 更新 | - | - |
| 输出状态 | - | - | ✅ 更新 |
| 知识卡片列表 | ✅ 添加 | - | - |
| 输出卡片列表 | - | ✅ 添加（生成时） | ✅ 更新（迭代次数） |
| 待转化列表 | - | ✅ 移除（生成时） | - |
| 结构分析记录 | - | ✅ 记录 | - |

**核心原则**：每个字段只由一个Agent维护，无冲突。

**v0.5.0 更新说明**：
- **结构Agent**：负责生成首版输出卡片，因此负责添加输出卡片列表、移除待转化列表
- **写作Agent**：负责迭代优化，因此负责更新输出卡片的迭代次数标记

---

## 📁 文件操作规范

### 项目结构
```
{WORK_DIR}/（工作目录名，如 vibe-writing-Tasihi）
├── _系统/（系统文件）
└── 项目/（所有项目）
    └── [项目名]/
        ├── 项目信息.md
        ├── 初始文档.md
        ├── 知识卡片/
        └── 输出卡片/
            ├── 初始文档/
            │   ├── 01-开篇.md
            │   └── 02-XX.md
            ├── [主题A]/
            └── [主题B]/
```

### 路径规则
- **当前工作目录**：通过 `pwd` 自动检测，提取最后一级目录名作为{WORK_DIR}
- **文件操作**（mkdir/Read/Write/Edit）：使用相对路径 `项目/`、`_系统/`
- **Obsidian功能**（Canvas/双链）：使用完整路径 `{WORK_DIR}/项目/...`
- ✅ 正确：`mkdir -p "项目/[项目名]/知识卡片"`
- ❌ 错误：`mkdir -p "[项目名]/知识卡片"`（缺少"项目/"前缀）

### 文件命名
- 项目名：简洁、准确（AI自己提取，不问用户）
- 知识卡片：`[序号]. [问题式标题].md`（序号从01开始，例如：`01. AI同时处理所有词，怎么组织成完整理解？.md`）
- 输出卡片节点：`01-[节点标题].md`
