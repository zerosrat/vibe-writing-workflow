> ç”¨æˆ·åœ¨æ•´ç†åšå®¢æ–‡ç« æ—¶ï¼Œéœ€è¦è¯¦ç»†è¯´æ˜é¡¹ç›®çš„ iOS æµ‹è¯•ç­–ç•¥ï¼ŒåŒ…æ‹¬å¦‚ä½•é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯è·¨å¹³å°çš„ä¸€è‡´æ€§ã€‚

## æµ‹è¯•ç­–ç•¥ï¼šè‡ªåŠ¨åŒ–éªŒè¯è·¨å¹³å°ä¸€è‡´æ€§

### 6.1 ç»Ÿä¸€æµ‹è¯•è„šæœ¬çš„è®¾è®¡

**test_ios.sh çš„å®ç°ç»†èŠ‚**

iOS æµ‹è¯•è„šæœ¬æ˜¯æ•´ä¸ªæµ‹è¯•ç­–ç•¥çš„æ ¸å¿ƒï¼Œå®ƒå°è£…äº† iOS æ¨¡æ‹Ÿå™¨çš„æ‰€æœ‰æ“ä½œï¼š

```bash
#!/bin/bash
# test_ios.sh - iOS æµ‹è¯•è‡ªåŠ¨åŒ–è„šæœ¬

# é»˜è®¤æ¨¡æ‹Ÿå™¨
DEFAULT_SIMULATOR="iPhone 16 Pro"

# æ ¸å¿ƒå‡½æ•°ï¼šåœ¨æŒ‡å®šæ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œæµ‹è¯•
run_on_simulator() {
    local simulator_name=$1
    local test_command=$2

    # å¯åŠ¨æ¨¡æ‹Ÿå™¨
    echo "ğŸ Booting simulator: $simulator_name"
    xcrun simctl boot "$simulator_name" 2>/dev/null

    # ç­‰å¾…å¯åŠ¨å®Œæˆ
    xcrun simctl spawn "$simulator_name" launchctl print system | grep -q "State = running"

    # å®‰è£…å¹¶è¿è¡Œæµ‹è¯•åº”ç”¨
    local app_path="./build_ios_sim/test_$test_command.app"
    xcrun simctl install "$simulator_name" "$app_path"
    xcrun simctl launch "$simulator_name" com.minirn.test.$test_command

    # æ”¶é›†æµ‹è¯•ç»“æœ
    xcrun simctl spawn "$simulator_name" log show --predicate 'subsystem == "com.minirn"' --info
}
```

**æ¨¡æ‹Ÿå™¨ç®¡ç†å’Œè‡ªåŠ¨åŒ–**

è„šæœ¬æä¾›äº†å®Œæ•´çš„æ¨¡æ‹Ÿå™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```bash
# æ¨¡æ‹Ÿå™¨çŠ¶æ€æ£€æŸ¥
check_simulator() {
    local simulator_name=$1
    local state=$(xcrun simctl list devices | grep "$simulator_name" | grep -o "Booted\|Shutdown")

    if [ "$state" = "Booted" ]; then
        echo "âœ… Simulator already running"
    else
        echo "ğŸ”„ Starting simulator..."
        xcrun simctl boot "$simulator_name"
    fi
}

# æ¸…ç†æ“ä½œ
cleanup() {
    echo "ğŸ§¹ Cleaning up..."
    xcrun simctl shutdown "$simulator_name" 2>/dev/null
}
```

**æ€§èƒ½åŸºå‡†çš„æŒç»­éªŒè¯**

æ¯ä¸ªæµ‹è¯•éƒ½åŒ…å«æ€§èƒ½æ£€æŸ¥ï¼š

```bash
# DeviceInfo æ€§èƒ½æµ‹è¯•
test_deviceinfo_performance() {
    echo "ğŸ“Š Running DeviceInfo performance test..."

    # è¿è¡Œæµ‹è¯•å¹¶æ•è·è¾“å‡º
    local result=$(run_on_simulator "$simulator" "deviceinfo")

    # æå–æ€§èƒ½æ•°æ®
    local duration=$(echo "$result" | grep "Bridge call duration" | grep -o '[0-9.]*')

    # æ€§èƒ½é˜ˆå€¼æ£€æŸ¥
    if (( $(echo "$duration < 50" | bc -l) )); then
        echo "âœ… Performance OK: ${duration}ms"
    else
        echo "âš ï¸ Performance issue: ${duration}ms (threshold: 50ms)"
    fi
}
```

### 6.2 CI/CD é›†æˆ

**GitHub Actions çš„å¤šå¹³å°æ„å»º**

```yaml
# .github/workflows/ci.yml
name: CI

jobs:
  test-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build and test on macOS
        run: |
          make build
          make test

  test-ios:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup iOS Simulator
        run: |
          xcrun simctl create "CI-iPhone" "iPhone 16 Pro"
          xcrun simctl boot "CI-iPhone"
      - name: Build and test on iOS
        run: |
          make ios-build
          make ios-test
```

**è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹**

å®Œæ•´çš„æµ‹è¯•æµç¨‹åŒ…æ‹¬ï¼š

```bash
# Makefile ä¸­çš„æµ‹è¯•é›†æˆ
.PHONY: test-all-platforms
test-all-platforms:
    @echo "ğŸ§ª Running tests on all platforms..."

    # macOS æµ‹è¯•
    @echo "1ï¸âƒ£ Testing on macOS..."
    @make test

    # iOS æµ‹è¯•
    @echo "2ï¸âƒ£ Testing on iOS..."
    @make ios-test

    # ä¸€è‡´æ€§éªŒè¯
    @echo "3ï¸âƒ£ Verifying cross-platform consistency..."
    @python scripts/verify_consistency.py
```

**æ€§èƒ½å›å½’æ£€æµ‹**

```python
# scripts/verify_consistency.py
import json
import sys

def verify_api_consistency():
    """éªŒè¯ API è¿”å›æ ¼å¼çš„ä¸€è‡´æ€§"""

    # è¯»å– macOS æµ‹è¯•ç»“æœ
    with open('test_results/macos.json', 'r') as f:
        macos_result = json.load(f)

    # è¯»å– iOS æµ‹è¯•ç»“æœ
    with open('test_results/ios.json', 'r') as f:
        ios_result = json.load(f)

    # æ£€æŸ¥å…³é”®å­—æ®µ
    required_fields = ['brand', 'manufacturer', 'systemVersion']
    for field in required_fields:
        if macos_result[field] != ios_result[field]:
            print(f"âŒ Inconsistency in {field}:")
            print(f"   macOS: {macos_result[field]}")
            print(f"   iOS: {ios_result[field]}")
            return False

    print("âœ… API consistency verified")
    return True

def verify_performance_benchmarks():
    """éªŒè¯æ€§èƒ½åŸºå‡†"""

    benchmarks = {
        'macos': 10,  # ms
        'ios_sim': 50,  # ms (æ¨¡æ‹Ÿå™¨è¾ƒæ…¢)
    }

    for platform, threshold in benchmarks.items():
        with open(f'performance/{platform}.json', 'r') as f:
            data = json.load(f)
            duration = data['bridge_call_duration']

        if duration > threshold:
            print(f"âš ï¸ Performance regression on {platform}: {duration}ms > {threshold}ms")
            return False

    print("âœ… Performance benchmarks verified")
    return True

if __name__ == "__main__":
    if not verify_api_consistency() or not verify_performance_benchmarks():
        sys.exit(1)
```

### æµ‹è¯•ç»“æœè§£è¯»

**DeviceInfo æµ‹è¯•ç¤ºä¾‹è¾“å‡º**

```
=== iOS DeviceInfo Module Test ===

1. Testing DeviceInfo methods directly...
   UniqueId: F67EDB44-DA12-45E3-800D-800BBB7F1FC6
   SystemVersion: 18.5.0
   DeviceId: x86_64

2. Testing Bridge communication...
   âœ… Native method call successful
   âœ… Return value type correct
   âœ… Exception handling works

3. Performance Results:
   Bridge call duration: 17.776 ms
   âš ï¸ Performance slower than expected (>= 10ms)
   â„¹ï¸ Note: Simulator performance is typically slower
```

**è·¨å¹³å°ä¸€è‡´æ€§æŠ¥å‘Š**

```
=== Cross-Platform Consistency Report ===

API Format Consistency:
âœ… Brand: "Apple" (both platforms)
âœ… Manufacturer: "Apple" (both platforms)
âœ… SystemVersion format: "X.Y.Z" (both platforms)

Performance Comparison:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Platformâ”‚ Duration â”‚ Threshold â”‚ Status â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ macOS   â”‚ 2.1ms    â”‚ 10ms      â”‚ âœ…     â”‚
â”‚ iOS Sim â”‚ 17.8ms   â”‚ 50ms      â”‚ âœ…     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Test Coverage:
âœ… Module registration: 100%
âœ… Method invocation: 100%
âœ… Error handling: 100%
âœ… Performance validation: 100%
```

### æµ‹è¯•ç­–ç•¥çš„ä»·å€¼

**è‡ªåŠ¨åŒ–å¸¦æ¥çš„å¥½å¤„**

1. **å¿«é€Ÿåé¦ˆ**ï¼šæ¯æ¬¡ä»£ç æäº¤éƒ½èƒ½è‡ªåŠ¨éªŒè¯
2. **å›å½’æ£€æµ‹**ï¼šåŠæ—¶å‘ç°æ€§èƒ½å’ŒåŠŸèƒ½é€€åŒ–
3. **ä¸€è‡´æ€§ä¿è¯**ï¼šç¡®ä¿å¤šå¹³å°è¡Œä¸ºä¸€è‡´

**æŒç»­é›†æˆçš„å®è·µ**

1. **å¤šå¹³å°å¹¶è¡Œ**ï¼šåŒæ—¶æµ‹è¯•æ‰€æœ‰æ”¯æŒçš„å¹³å°
2. **å¿«é€Ÿå¤±è´¥**ï¼šä»»ä½•å¹³å°æµ‹è¯•å¤±è´¥ç«‹å³åœæ­¢
3. **è¯¦ç»†æŠ¥å‘Š**ï¼šç”Ÿæˆæ˜“äºé˜…è¯»çš„æµ‹è¯•æŠ¥å‘Š

> è¿™å¼ å¡ç‰‡è¯¦ç»†å±•ç¤ºäº†é¡¹ç›®çš„ iOS æµ‹è¯•ç­–ç•¥ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬å’Œ CI/CD é›†æˆï¼Œç¡®ä¿äº†è·¨å¹³å°çš„ä¸€è‡´æ€§å’Œæ€§èƒ½åŸºå‡†çš„æŒç»­éªŒè¯ã€‚